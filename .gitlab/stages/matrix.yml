test_matrix:
  stage: tests
  variables:
    ARTIFACTS_PATH: .github/artifacts/pytest
    PYTEST_ARGS: "-n 5"
  script:
    - >
      bash docker/run.sh ${IMAGE_REPO_TAG}
      python3 -m pytest ${PYTEST_PATH} {PYTEST_ARGS}
      --junitxml=${PYTEST_ARTIFACTS_PATH}/${PYTEST_PATH}/junit.xml
  artifacts:
    when: always
    expire_in: "1 day"
    reports:
      junit: ${PYTEST_ARTIFACT_PATH}/${PYTEST_PATH}/junit.xml
  tags:
    - ${TAGS}
  parallel:
    matrix:
      - PYTEST_PATH: [
        'tests'
      ]
